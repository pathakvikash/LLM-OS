<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Search Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    .test-section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .test-button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    .test-button:hover {
      background: #0056b3;
    }
    .result {
      margin-top: 10px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 5px;
      white-space: pre-wrap;
    }
    .error {
      color: #dc3545;
    }
    .success {
      color: #28a745;
    }
  </style>
</head>
<body>
  <h1>üîç Web Search System Test</h1>
  
  <div class="test-section">
    <h3>1. Configuration Test</h3>
    <button class="test-button" onclick="testConfig()">Test Configuration</button>
    <div id="configResult" class="result"></div>
  </div>

  <div class="test-section">
    <h3>2. Web Search API Test</h3>
    <input type="text" id="searchQuery" placeholder="Enter search query" value="artificial intelligence" style="width: 300px; padding: 8px; margin-right: 10px;">
    <button class="test-button" onclick="testWebSearch()">Test Web Search</button>
    <div id="searchResult" class="result"></div>
  </div>

  <div class="test-section">
    <h3>3. Content Extraction Test</h3>
    <input type="text" id="extractUrl" placeholder="Enter URL to extract content" value="https://example.com" style="width: 300px; padding: 8px; margin-right: 10px;">
    <button class="test-button" onclick="testContentExtraction()">Test Content Extraction</button>
    <div id="extractResult" class="result"></div>
  </div>

  <div class="test-section">
    <h3>4. Search Suggestions Test</h3>
    <input type="text" id="suggestionQuery" placeholder="Enter query for suggestions" value="machine learning" style="width: 300px; padding: 8px; margin-right: 10px;">
    <button class="test-button" onclick="testSuggestions()">Test Suggestions</button>
    <div id="suggestionResult" class="result"></div>
  </div>

  <div class="test-section">
    <h3>5. Cache Management Test</h3>
    <button class="test-button" onclick="testCacheStats()">Get Cache Stats</button>
    <button class="test-button" onclick="testClearCache()">Clear Cache</button>
    <div id="cacheResult" class="result"></div>
  </div>

  <script>
    // Load the web search system
    async function loadWebSearchSystem() {
      try {
        // Load all required scripts
        const scripts = [
          'js/config.js',
          'js/Logger.js',
          'js/SearchProviders/BaseSearchProvider.js',
          'js/SearchProviders/DuckDuckGoSearch.js',
          'js/SearchProviders/GoogleSearch.js',
          'js/SearchProviders/BingSearch.js',
          'js/WebSearchAPI.js'
        ];

        for (const script of scripts) {
          await loadScript(script);
        }

        // Initialize components
        window.config = new AppConfig();
        window.logger = new Logger(config);
        window.webSearchAPI = new WebSearchAPI(config, logger);

        console.log('Web Search System loaded successfully');
        return true;
      } catch (error) {
        console.error('Failed to load Web Search System:', error);
        return false;
      }
    }

    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }

    async function testConfig() {
      const resultDiv = document.getElementById('configResult');
      try {
        resultDiv.innerHTML = 'Testing configuration...';
        
        const webSearchConfig = config.get('webSearch');
        const providers = Object.keys(webSearchConfig.providers);
        const enabledProviders = providers.filter(p => webSearchConfig.providers[p].enabled);
        
        resultDiv.innerHTML = `
          <div class="success">‚úÖ Configuration loaded successfully!</div>
          <strong>Available providers:</strong> ${providers.join(', ')}
          <br><strong>Enabled providers:</strong> ${enabledProviders.join(', ')}
          <br><strong>Cache enabled:</strong> ${webSearchConfig.cache.enabled}
          <br><strong>AI analysis enabled:</strong> ${webSearchConfig.ai.enabled}
        `;
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">‚ùå Configuration test failed: ${error.message}</div>`;
      }
    }

    async function testWebSearch() {
      const resultDiv = document.getElementById('searchResult');
      const query = document.getElementById('searchQuery').value;
      
      try {
        resultDiv.innerHTML = 'Searching...';
        
        const results = await webSearchAPI.search(query, { maxResults: 3 });
        
        resultDiv.innerHTML = `
          <div class="success">‚úÖ Search completed successfully!</div>
          <strong>Query:</strong> ${query}
          <br><strong>Results found:</strong> ${results.length}
          <br><strong>First result:</strong> ${results[0] ? results[0].title : 'None'}
        `;
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">‚ùå Search failed: ${error.message}</div>`;
      }
    }

    async function testContentExtraction() {
      const resultDiv = document.getElementById('extractResult');
      const url = document.getElementById('extractUrl').value;
      
      try {
        resultDiv.innerHTML = 'Extracting content...';
        
        const content = await webSearchAPI.extractContent(url);
        
        resultDiv.innerHTML = `
          <div class="success">‚úÖ Content extraction completed!</div>
          <strong>URL:</strong> ${url}
          <br><strong>Content length:</strong> ${content.length} characters
          <br><strong>Preview:</strong> ${content.substring(0, 200)}...
        `;
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">‚ùå Content extraction failed: ${error.message}</div>`;
      }
    }

    async function testSuggestions() {
      const resultDiv = document.getElementById('suggestionResult');
      const query = document.getElementById('suggestionQuery').value;
      
      try {
        resultDiv.innerHTML = 'Getting suggestions...';
        
        const suggestions = await webSearchAPI.getSearchSuggestions(query);
        
        resultDiv.innerHTML = `
          <div class="success">‚úÖ Suggestions retrieved successfully!</div>
          <strong>Query:</strong> ${query}
          <br><strong>Suggestions:</strong> ${suggestions.join(', ')}
        `;
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">‚ùå Suggestions failed: ${error.message}</div>`;
      }
    }

    async function testCacheStats() {
      const resultDiv = document.getElementById('cacheResult');
      
      try {
        const stats = webSearchAPI.getCacheStats();
        
        resultDiv.innerHTML = `
          <div class="success">‚úÖ Cache stats retrieved!</div>
          <strong>Cache size:</strong> ${stats.size}
          <br><strong>Cache keys:</strong> ${stats.keys.length}
        `;
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">‚ùå Cache stats failed: ${error.message}</div>`;
      }
    }

    async function testClearCache() {
      const resultDiv = document.getElementById('cacheResult');
      
      try {
        webSearchAPI.clearCache();
        
        resultDiv.innerHTML = `
          <div class="success">‚úÖ Cache cleared successfully!</div>
        `;
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">‚ùå Cache clear failed: ${error.message}</div>`;
      }
    }

    // Initialize when page loads
    window.addEventListener('load', async () => {
      const success = await loadWebSearchSystem();
      if (success) {
        document.body.innerHTML += '<div style="background: #d4edda; color: #155724; padding: 10px; margin-top: 20px; border-radius: 5px;">‚úÖ Web Search System loaded successfully! You can now run the tests above.</div>';
      } else {
        document.body.innerHTML += '<div style="background: #f8d7da; color: #721c24; padding: 10px; margin-top: 20px; border-radius: 5px;">‚ùå Failed to load Web Search System. Check the console for errors.</div>';
      }
    });
  </script>
</body>
</html> 